<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOKEMI - Избранное</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        .favorites-main {
            padding-top: 8px;
        }

        .favorites-empty {
            text-align: center;
            padding: 34px 18px;
            border-radius: var(--radius-md);
            background: rgba(139, 163, 197, 0.16);
        }

        .favorites-empty h3 {
            margin: 0 0 10px;
            font-family: var(--font-display);
        }

        .favorites-empty p {
            margin: 0 0 16px;
            color: var(--color-text-light);
        }

        .favorites-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .favorites-item {
            display: grid;
            grid-template-columns: 96px minmax(220px, 1.3fr) minmax(140px, 0.7fr) 44px;
            grid-template-areas: "image info price remove";
            gap: 14px;
            align-items: center;
            border: 1px solid rgba(0, 0, 0, 0.09);
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
        }

        .favorites-item-image {
            width: 96px;
            height: 96px;
            border-radius: 14px;
            object-fit: cover;
            background: #ece8db;
            justify-self: start;
            grid-area: image;
        }

        .favorites-item-title {
            margin: 0 0 6px;
            font-size: 16px;
            line-height: 1.3;
        }

        .favorites-item-title-link {
            color: inherit;
            text-decoration: none;
        }

        .favorites-item-title-link:hover {
            text-decoration: underline;
        }

        .favorites-item-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 0;
            justify-self: start;
            text-align: left;
            grid-area: info;
        }

        .favorites-item-meta {
            margin: 0;
            font-size: 13px;
            color: var(--color-text-light);
        }

        .favorites-item-price {
            display: grid;
            gap: 6px;
            justify-items: end;
            justify-self: end;
            grid-area: price;
        }

        .favorites-item-label {
            margin: 0;
            font-size: 13px;
            color: var(--color-text-light);
            text-align: right;
        }

        .favorites-item-value {
            margin: 0;
            font-weight: 700;
            white-space: nowrap;
            text-align: right;
        }

        .favorites-remove {
            justify-self: end;
            grid-area: remove;
        }

        .favorites-remove-btn {
            border: 1px solid rgba(0, 0, 0, 0.15);
            background: #fff;
            color: #9c4a57;
            border-radius: 12px;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .icon-trash {
            width: 18px;
            height: 18px;
            background-color: currentColor;
            -webkit-mask: url("/images/trash.svg") center / contain no-repeat;
            mask: url("/images/trash.svg") center / contain no-repeat;
        }

        .favorites-summary {
            margin-top: 16px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding-top: 16px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .favorites-total {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
        }

        .favorites-summary-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        @media (max-width: 1023px) {
            .favorites-item {
                grid-template-columns: 80px minmax(0, 1fr) minmax(140px, 0.7fr) 44px;
                grid-template-areas:
                    "image info info remove"
                    "image price price remove";
            }

            .favorites-item-image {
                width: 80px;
                height: 80px;
            }
        }

        @media (max-width: 767px) {
            .favorites-item {
                grid-template-columns: 70px minmax(0, 1fr);
                gap: 10px;
                grid-template-areas:
                    "image info"
                    "price price"
                    "remove remove";
                padding: 12px;
            }

            .favorites-item-image {
                width: 70px;
                height: 70px;
            }

            .favorites-item-price {
                text-align: center;
            }

            .favorites-item-price,
            .favorites-remove {
                justify-self: center;
            }

            .favorites-item-price {
                width: 100%;
                padding: 8px 10px;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.55);
            }

            .favorites-item-info {
                align-items: flex-start;
            }

            .favorites-item-title {
                font-size: 16px;
            }

            .favorites-summary {
                flex-direction: column;
                align-items: stretch;
            }

            .favorites-summary-actions .btn {
                width: 100%;
            }
        }

        @media (max-width: 520px) {
            .favorites-item {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "image"
                    "info"
                    "price"
                    "remove";
                justify-items: start;
            }

            .favorites-item-image {
                width: 100%;
                height: auto;
                aspect-ratio: 1 / 1;
            }

            .favorites-item-info,
            .favorites-item-price,
            .favorites-remove {
                justify-self: stretch;
                width: 100%;
            }

            .favorites-remove {
                justify-self: center;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="header">
        <div class="container header-container">
            <a href="/index.html" class="logo">
                <img src="/images/logo.svg" alt="Sokemi" class="logo-image">
            </a>

            <nav class="nav">
                <a href="/pages/site/about.html" class="nav-link">О нас</a>
                <a href="/index.html" class="nav-link">Главная</a>
                <a href="/pages/site/catalogue.html" class="nav-link">Каталог</a>
                <a href="/pages/site/contacts.html" class="nav-link">Контакты</a>
            </nav>

            <div class="header-actions">
                <div class="search-wrapper">
                    <input type="text" placeholder="Поиск..." class="search-input">
                    <button class="search-btn" type="button">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
                <a href="/pages/site/profile.html" class="header-avatar">
                    <img src="https://basket-25.wbbasket.ru/vol4435/part443550/443550372/images/big/1.webp" alt="profile">
                </a>
                <a href="/pages/site/favorites.html" class="icon-btn favorites-btn" aria-label="Избранное">
                    <span class="icon-like" aria-hidden="true"></span>
                </a>
                <a href="/pages/site/cart.html" class="icon-btn cart-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>

                    <!-- ВОТ ЭТО ДОБАВИТЬ -->
                    <span class="cart-count-badge" id="cart-count-badge">0</span>
                </a>
                <button class="mobile-menu-btn" aria-label="Открыть меню" type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </div>
</header>

<div class="mobile-menu">
    <div class="mobile-menu-header">
        <a href="/index.html" class="logo">
            <img src="/images/logo.svg" alt="Sokemi" class="logo-image">
        </a>
        <button class="mobile-menu-close" aria-label="Закрыть меню" type="button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6 6 18"></path>
                <path d="m6 6 12 12"></path>
            </svg>
        </button>
    </div>
    <nav class="mobile-nav">
        <a href="/pages/site/about.html" class="mobile-nav-link">О нас</a>
        <a href="/index.html" class="mobile-nav-link">Главная</a>
        <a href="/pages/site/catalogue.html" class="mobile-nav-link">Каталог</a>
        <a href="/pages/site/contacts.html" class="mobile-nav-link">Контакты</a>
    </nav>
</div>
<div class="mobile-overlay"></div>

<main class="main favorites-main">
    <div class="container">
        <div class="section-header">
            <h1 class="section-title">ИЗБРАННОЕ</h1>
        </div>

        <section>
            <div class="favorites-empty" id="favorites-empty" hidden>
                <h3>В избранном пока пусто</h3>
                <p>Добавьте товары из каталога, чтобы быстро вернуться к ним.</p>
                <a href="/pages/site/catalogue.html" class="btn btn-primary">Перейти в каталог</a>
            </div>

            <div id="favorites-content">
                <div class="favorites-list" id="favorites-list"></div>

                <div class="favorites-summary">
                    <p class="favorites-total" id="favorites-total">Всего товаров: 0</p>
                    <div class="favorites-summary-actions">
                        <button type="button" class="btn btn-outline" id="clear-favorites-btn">Очистить избранное</button>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <div class="newsletter">
            <div class="newsletter-left">
                <h3 class="newsletter-title">Готовы узнавать о новинках?</h3>
                <form class="newsletter-form">
                    <input type="email" placeholder="Ваш Email" class="newsletter-input">
                    <button type="submit" class="btn btn-primary">Отправить</button>
                </form>
            </div>
            <div class="newsletter-right">
                <h4 class="newsletter-subtitle">Товары для дома и питомцев</h4>
                <p class="newsletter-text">Мы подберём лучшие решения для вашего любимца и создадим комфорт вместе с вами.</p>
            </div>
        </div>

        <div class="footer-links">
            <div class="footer-column">
                <h4 class="footer-column-title">О компании</h4>
                <ul class="footer-list">
                    <li><a href="#">Блог</a></li>
                    <li><a href="#">Наша команда</a></li>
                    <li><a href="#">Контакты</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4 class="footer-column-title">Поддержка</h4>
                <ul class="footer-list">
                    <li><a href="#">Связаться с нами</a></li>
                    <li><a href="#">Доставка</a></li>
                    <li><a href="#">Возврат</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4 class="footer-column-title">Социальные сети</h4>
                <div class="socials">
                    <a href="#" class="social-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.684 0H8.316C1.592 0 0 1.592 0 8.316v7.368C0 22.408 1.592 24 8.316 24h7.368C22.408 24 24 22.408 24 15.684V8.316C24 1.592 22.408 0 15.684 0zm3.692 17.123h-1.744c-.66 0-.864-.525-2.05-1.727-1.033-1-1.49-1.135-1.744-1.135-.356 0-.458.102-.458.593v1.575c0 .424-.135.678-1.253.678-1.846 0-3.896-1.118-5.335-3.202C4.624 10.857 4 8.673 4 8.231c0-.254.102-.491.593-.491h1.744c.44 0 .61.203.78.677.863 2.49 2.303 4.675 2.896 4.675.22 0 .322-.102.322-.66V9.721c-.068-1.186-.695-1.287-.695-1.71 0-.203.17-.407.44-.407h2.744c.373 0 .508.203.508.643v3.473c0 .372.17.508.271.508.22 0 .407-.136.814-.542 1.27-1.422 2.176-3.61 2.176-3.61.119-.254.322-.491.763-.491h1.744c.525 0 .644.27.525.643-.22 1.017-2.354 4.031-2.354 4.031-.186.305-.254.44 0 .78.186.254.796.779 1.203 1.253.745.847 1.32 1.558 1.473 2.05.17.49-.085.744-.576.744z"/>
                        </svg>
                        VK
                    </a>
                    <a href="#" class="social-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        Telegram
                    </a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">© 2026 SOKEMI. Все права защищены.</p>
            <div class="legal-links">
                <a href="#">Пользовательское соглашение</a>
                <a href="#">Политика конфиденциальности</a>
            </div>
        </div>
    </div>
</footer>

<script src="/script.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const list = document.getElementById("favorites-list");
    const content = document.getElementById("favorites-content");
    const empty = document.getElementById("favorites-empty");
    const totalEl = document.getElementById("favorites-total");
    const clearBtn = document.getElementById("clear-favorites-btn");

    const CATALOG_STORAGE_KEY = "sokemi.catalog.v2";
    const PLACEHOLDER_IMAGE = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='400'><rect width='100%' height='100%' fill='%23e5e2d3'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-family='Arial' font-size='20'>No Image</text></svg>";

    let favorites = readFavoriteIds();
    let products = readCatalogProducts();

    list.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;

        const button = target.closest("button[data-action]");
        if (!button) return;

        const id = String(button.dataset.id || "");
        const action = String(button.dataset.action || "");
        if (!id || !action) return;

        if (action === "remove") {
            removeFavorite(id);
        }
    });

    clearBtn.addEventListener("click", () => {
        if (!favorites.length) return;
        favorites = [];
        saveFavorites();
        render();
    });

    render();

    function render() {
        list.innerHTML = "";

        if (!favorites.length) {
            content.hidden = true;
            empty.hidden = false;
            totalEl.textContent = "Всего товаров: 0";
            return;
        }

        const items = findFavoriteProducts(favorites, products);
        if (!items.length) {
            content.hidden = true;
            empty.hidden = false;
            totalEl.textContent = "Всего товаров: 0";
            return;
        }

        content.hidden = false;
        empty.hidden = true;

        const fragment = document.createDocumentFragment();

        items.forEach((item) => {
            const article = document.createElement("article");
            article.className = "favorites-item";
            article.innerHTML = `
                <img class="favorites-item-image" src="${escapeHtml(item.image)}" alt="${escapeHtml(item.name)}">
                <div class="favorites-item-info">
                    <h3 class="favorites-item-title">
                        <a class="favorites-item-title-link" href="/pages/site/catalogue.html#product=${encodeURIComponent(item.id)}">${escapeHtml(item.name)}</a>
                    </h3>
                    <p class="favorites-item-meta">${escapeHtml(item.meta)}</p>
                </div>
                <div class="favorites-item-price">
                    <p class="favorites-item-label">Цена за шт.</p>
                    <p class="favorites-item-value">${formatPrice(item.price)}</p>
                </div>
                <div class="favorites-remove">
                    <button type="button" class="favorites-remove-btn" data-action="remove" data-id="${escapeHtml(item.id)}" aria-label="Удалить">
                        <span class="icon-trash" aria-hidden="true"></span>
                    </button>
                </div>
            `;

            fragment.appendChild(article);
        });

        list.appendChild(fragment);
        totalEl.textContent = `Всего товаров: ${items.length}`;
    }

    function removeFavorite(id) {
        favorites = favorites.filter((itemId) => itemId !== id);
        saveFavorites();
        render();
    }

    function readFavoriteIds() {
        try {
            const raw = localStorage.getItem("favorites");
            const parsed = raw ? JSON.parse(raw) : [];
            if (!Array.isArray(parsed)) return [];
            return parsed.map((item) => String(item || "").trim()).filter(Boolean);
        } catch {
            return [];
        }
    }

    function saveFavorites() {
        localStorage.setItem("favorites", JSON.stringify(favorites));
    }

    function findFavoriteProducts(favoriteIds, productsList) {
        const lookup = new Map(productsList.map((item) => [item.id, item]));
        return favoriteIds
            .map((id) => lookup.get(id))
            .filter(Boolean)
            .map((item) => ({
                id: item.id,
                name: item.name,
                image: item.image,
                price: item.price,
                meta: `${item.categoryName ? `Категория: ${item.categoryName}` : "Категория: не указана"}`
            }));
    }

    function readCatalogProducts() {
        try {
            const raw = localStorage.getItem(CATALOG_STORAGE_KEY);
            const parsed = raw ? JSON.parse(raw) : null;
            const categories = Array.isArray(parsed?.categories) ? parsed.categories : [];
            const items = [];

            categories.forEach((category) => {
                const categoryName = String(category?.name || "").trim();
                const categoryImage = String(category?.imageUrl || "").trim();
                const productsList = Array.isArray(category?.products) ? category.products : [];

                productsList.forEach((product, index) => {
                    const id = String(product?.id || `prod-${index + 1}`).trim();
                    const image = pickProductImage(product, categoryImage);
                    items.push({
                        id,
                        name: String(product?.name || "Товар без названия").trim(),
                        price: Number(product?.price) || 0,
                        categoryName,
                        image
                    });
                });
            });

            return items;
        } catch {
            return [];
        }
    }

    function pickProductImage(product, categoryImage) {
        if (Array.isArray(product?.images) && product.images.length) {
            const first = String(product.images[0] || "").trim();
            if (first) return first;
        }

        return categoryImage || PLACEHOLDER_IMAGE;
    }

    function formatPrice(value) {
        const safe = Math.max(0, Number(value) || 0);
        return `${new Intl.NumberFormat("ru-RU").format(safe)} ₽`;
    }

    function escapeHtml(value) {
        return String(value || "")
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#39;");
    }
});
</script>

</body>
</html>

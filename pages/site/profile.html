<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Профиль — SOKEMI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/styles.css">

<style>

.profile-container {
    width: 80%;
    margin: 80px auto;
}

.profile-layout {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 60px;
}

/* SIDEBAR */

.profile-sidebar {
    background: #8BA3C5;
    border-radius: var(--radius-xl);
    padding: 40px;
    text-align: center;
    color: white;
    box-shadow: var(--shadow-lg);
}

.avatar {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    overflow: hidden;
    margin: 0 auto 20px;
    border: 5px solid white;
    box-shadow: var(--shadow-md);
}

.avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-name {
    font-family: var(--font-display);
    font-size: 24px;
    margin-bottom: 6px;
}

.profile-email {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 30px;
}

.profile-menu button {
    width: 100%;
    padding: 12px;
    border-radius: 50px;
    margin-bottom: 12px;
    background: white;
    color: #8BA3C5;
    font-weight: 500;
    transition: var(--transition-normal);
}

.profile-menu button:hover,
.profile-menu button.active {
    background: #6f8db6;
    color: white;
}

/* CONTENT */

.profile-content {
    background: #8BA3C5;
    border-radius: var(--radius-xl);
    padding: 50px;
    color: white;
    box-shadow: var(--shadow-lg);
}

.profile-card h3 {
    font-family: var(--font-display);
    margin-bottom: 20px;
}

.profile-card p {
    margin-bottom: 10px;
    font-size: 15px;
}

/* ORDERS */

.order-item {
    background: rgba(255,255,255,0.25);
    padding: 16px 20px;
    border-radius: 20px;
    margin-bottom: 15px;
    backdrop-filter: blur(4px);
}

.order-status {
    float: right;
    background: white;
    color: #8BA3C5;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
}

.favorites-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.favorite-row {
    display: grid;
    grid-template-columns: 88px 1fr auto;
    gap: 14px;
    align-items: center;
    background: rgba(255,255,255,0.2);
    border-radius: 18px;
    padding: 10px;
}

.favorite-thumb {
    width: 88px;
    height: 88px;
    border-radius: 14px;
    object-fit: cover;
    background: rgba(255,255,255,0.75);
}

.favorite-title {
    margin: 0 0 4px;
    font-size: 16px;
    font-weight: 600;
}

.favorite-meta {
    margin: 0;
    opacity: 0.95;
    font-size: 13px;
}

.favorite-link {
    min-width: 120px;
    text-align: center;
}

.favorites-empty {
    margin: 0;
    opacity: 0.95;
}

/* HIDE TABS */
.hidden {
    display: none;
}

/* RESPONSIVE */
@media (max-width: 1023px) {
    .profile-container {
        width: 92%;
    }

    .profile-layout {
        grid-template-columns: 1fr;
    }

    .profile-content {
        padding: 32px 24px;
    }
}

@media (max-width: 639px) {
    .profile-sidebar {
        padding: 28px 20px;
    }

    .favorite-row {
        grid-template-columns: 72px 1fr;
    }

    .favorite-thumb {
        width: 72px;
        height: 72px;
    }

    .favorite-link {
        grid-column: 1 / -1;
        width: 100%;
    }
}

</style>
</head>

<body>

<!-- HEADER -->
<header class="header">
    <div class="container header-container">
        <a href="./pages/admin/catalog.html" class="logo">
            <img src="../../images/logo.svg" alt="Sokemi" class="logo-image">
        </a>
        
        <nav class="nav">
            <a href="/pages/site/about.html" class="nav-link">&#1054; &#1085;&#1072;&#1089;</a>
            <a href="/index.html" class="nav-link active">&#1043;&#1083;&#1072;&#1074;&#1085;&#1072;&#1103;</a>
            <a href="/pages/site/catalogue.html" class="nav-link">&#1050;&#1072;&#1090;&#1072;&#1083;&#1086;&#1075;</a>
            <a href="/pages/site/contacts.html" class="nav-link">&#1050;&#1086;&#1085;&#1090;&#1072;&#1082;&#1090;&#1099;</a>
        </nav>
        
        <div class="header-actions">
            <div class="search-wrapper">
                <input type="text" placeholder="Поиск..." class="search-input">
                <button class="search-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </div>
            <button class="icon-btn cart-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
            </button>
            <button class="mobile-menu-btn" aria-label="Открыть меню">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
</header>

<!-- MOBILE MENU -->
<div class="mobile-menu">
    <div class="mobile-menu-header">
        <a href="#" class="logo">
            <img src="../../images/logo.svg" alt="Sokemi" class="logo-image">
        </a>
        <button class="mobile-menu-close" aria-label="Закрыть меню">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6 6 18"></path>
                <path d="m6 6 12 12"></path>
            </svg>
        </button>
    </div>
    <nav class="mobile-nav">
        <a href="/pages/site/about.html" class="mobile-nav-link">&#1054; &#1085;&#1072;&#1089;</a>
        <a href="/index.html" class="mobile-nav-link active">&#1043;&#1083;&#1072;&#1074;&#1085;&#1072;&#1103;</a>
        <a href="/pages/site/catalogue.html" class="mobile-nav-link">&#1050;&#1072;&#1090;&#1072;&#1083;&#1086;&#1075;</a>
        <a href="/pages/site/contacts.html" class="mobile-nav-link">&#1050;&#1086;&#1085;&#1090;&#1072;&#1082;&#1090;&#1099;</a>
    </nav>
</div>
<div class="mobile-overlay"></div>


<main class="main">

<div class="profile-container">

    <div class="section-header">
        <h2 class="section-title">МОЙ ПРОФИЛЬ</h2>
    </div>

    <div class="profile-layout">

        <!-- SIDEBAR -->
        <div class="profile-sidebar">

            <div class="avatar">
                <img src="https://basket-25.wbbasket.ru/vol4435/part443550/443550372/images/big/1.webp" alt="avatar">
            </div>

            <div class="profile-name">Анна Кузнецова</div>
            <div class="profile-email">anna@email.ru</div>

            <div class="profile-menu">
                <button class="tab-btn active" data-tab="info">Личные данные</button>
                <button class="tab-btn" data-tab="orders">История заказов</button>
                <button class="tab-btn" data-tab="favorites">Избранное</button>
                <button class="tab-btn" data-tab="settings">Настройки</button>
            </div>

        </div>

        <!-- CONTENT -->
        <div class="profile-content">

            <div id="info" class="tab-content">
                <div class="profile-card">
                    <h3>Основная информация</h3>
                    <p><strong>Имя:</strong> Анна</p>
                    <p><strong>Фамилия:</strong> Кузнецова</p>
                    <p><strong>Телефон:</strong> +7 (999) 123-45-67</p>
                    <p><strong>Город:</strong> Москва</p>
                </div>
            </div>

            <div id="orders" class="tab-content hidden">
                <div class="profile-card">
                    <h3>История заказов</h3>

                    <div class="order-item">
                        Заказ №1042 — Когтеточка
                        <span class="order-status">Доставлен</span>
                    </div>

                    <div class="order-item">
                        Заказ №1051 — Корм Royal Canin
                        <span class="order-status">В пути</span>
                    </div>

                    <div class="order-item">
                        Заказ №1063 — Игрушки
                        <span class="order-status">Обработка</span>
                    </div>

                </div>
            </div>

            <div id="settings" class="tab-content hidden">
                <div class="profile-card">
                    <h3>Настройки аккаунта</h3>
                    <button class="btn btn-primary">Сменить пароль</button>
                </div>
            </div>

            <div id="favorites" class="tab-content hidden">
                <div class="profile-card">
                    <h3>Избранные товары</h3>
                    <div class="favorites-list" id="favorites-list"></div>
                    <p class="favorites-empty hidden" id="favorites-empty">Пока нет избранных товаров. Добавьте их в каталоге через сердечко.</p>
                </div>
            </div>

        </div>
    </div>
</div>

</main>

<!-- ТВОЙ ФУТЕР БЕЗ ИЗМЕНЕНИЙ -->
<footer class="footer">
    <div class="container">
        <!-- сюда вставь полностью тот footer, который ты прислала -->
    </div>
</footer>

<script>
const buttons = document.querySelectorAll('.tab-btn');
const tabs = document.querySelectorAll('.tab-content');
const favoritesList = document.getElementById('favorites-list');
const favoritesEmpty = document.getElementById('favorites-empty');

const CATALOG_STORAGE_KEY = 'sokemi.catalog.v2';
const PLACEHOLDER_IMAGE = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='400'><rect width='100%' height='100%' fill='%23e5e2d3'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-family='Arial' font-size='20'>No Image</text></svg>";

buttons.forEach(btn => {
    btn.addEventListener('click', () => {
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        tabs.forEach(tab => tab.classList.add('hidden'));
        document.getElementById(btn.dataset.tab).classList.remove('hidden');
    });
});

renderFavorites();

function renderFavorites() {
    if (!favoritesList || !favoritesEmpty) return;

    const favoriteIds = readFavoriteIds();
    const items = findFavoriteProducts(favoriteIds);

    favoritesList.innerHTML = '';
    favoritesEmpty.classList.add('hidden');

    if (!items.length) {
        favoritesEmpty.classList.remove('hidden');
        return;
    }

    const fragment = document.createDocumentFragment();
    items.forEach((item) => {
        const row = document.createElement('article');
        row.className = 'favorite-row';
        row.innerHTML = `
            <img class="favorite-thumb" src="${escapeHtml(item.image)}" alt="${escapeHtml(item.name)}">
            <div>
                <p class="favorite-title">${escapeHtml(item.name)}</p>
                <p class="favorite-meta">${escapeHtml(item.meta)}</p>
            </div>
            <a class="btn btn-outline favorite-link" href="/pages/site/catalogue.html#product=${encodeURIComponent(item.id)}">Перейти к товару</a>
        `;
        fragment.appendChild(row);
    });

    favoritesList.appendChild(fragment);
}

function readFavoriteIds() {
    try {
        const raw = localStorage.getItem('favorites');
        const parsed = raw ? JSON.parse(raw) : [];
        if (!Array.isArray(parsed)) return [];
        return parsed.map((item) => String(item || '').trim()).filter(Boolean);
    } catch {
        return [];
    }
}

function findFavoriteProducts(favoriteIds) {
    const ids = new Set(favoriteIds);
    if (!ids.size) return [];

    const products = readCatalogProducts();
    return products
        .filter((item) => ids.has(item.id))
        .map((item) => ({
            id: item.id,
            name: item.name,
            image: item.image,
            meta: `${item.categoryName ? `Категория: ${item.categoryName}` : 'Категория: не указана'} • ${formatPrice(item.price)}`
        }));
}

function readCatalogProducts() {
    try {
        const raw = localStorage.getItem(CATALOG_STORAGE_KEY);
        const parsed = raw ? JSON.parse(raw) : null;
        const categories = Array.isArray(parsed?.categories) ? parsed.categories : [];
        const items = [];

        categories.forEach((category) => {
            const categoryName = String(category?.name || '').trim();
            const categoryImage = String(category?.imageUrl || '').trim();
            const products = Array.isArray(category?.products) ? category.products : [];

            products.forEach((product, index) => {
                const id = String(product?.id || `prod-${index + 1}`).trim();
                const image = pickProductImage(product, categoryImage);
                items.push({
                    id,
                    name: String(product?.name || 'Товар без названия').trim(),
                    price: Number(product?.price) || 0,
                    categoryName,
                    image
                });
            });
        });

        return items;
    } catch {
        return [];
    }
}

function pickProductImage(product, categoryImage) {
    if (Array.isArray(product?.images) && product.images.length) {
        const first = String(product.images[0] || '').trim();
        if (first) return first;
    }

    return categoryImage || PLACEHOLDER_IMAGE;
}

function formatPrice(value) {
    const safe = Math.max(0, Number(value) || 0);
    return `${new Intl.NumberFormat('ru-RU').format(safe)} ₽`;
}

function escapeHtml(value) {
    return String(value || '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
}
</script>

</body>
</html>

